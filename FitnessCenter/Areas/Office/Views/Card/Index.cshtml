@model IEnumerable<DataObjects.Entities.tMemberType>
@{
    ViewBag.Title = "Member Index";
}

@section styles{
    <link href="~/Assets/admin/pages/css/todo.css" rel="stylesheet" type="text/css" />
}

<!-- BEGIN PAGE HEADER-->

<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title">
        <h1>
            Master <small>Member</small>
        </h1>
    </div>
</div>

@Html.Partial("_pageBreadcrumbs")


<div class="row">
    <div class="col-md-12">
        <!-- BEGIN TODO SIDEBAR -->
        <div class="todo-sidebar">
            <div class="portlet light">
                <div class="portlet-title">
                    <div class="caption" data-toggle="collapse" data-target=".todo-project-list-content">
                        <span class="caption-subject font-green-sharp bold uppercase">Member Type </span>
                    </div>

                </div>
                <div class="portlet-body todo-project-list-content">
                    <div class="todo-project-list">
                        <ul id="memberType" class="nav nav-pills nav-stacked">
                            <li class="active">
                                <a href="#">
                                    New
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Monthly
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Platinum
                                </a>
                            </li>

                            <li>
                                <a href="#">
                                    Diamond
                                </a>
                            </li>

                            <li>
                                <a href="#">
                                    Family
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- END TODO SIDEBAR -->
        <!-- BEGIN TODO CONTENT -->
        <div class="todo-content">
            <!-- END PAGE HEADER-->
            <!-- BEGIN PAGE CONTENT-->
            <div class="col-md-12">
                <div class="portlet light">
                    <div class="portlet-body">
                        <div class="row margin-bottom-20">
                            <div class="col-md-5 col-sm-4">
                                <div class="row">
                                    <div class="pull-left">
                                        <i class="icon-basket font-green-sharp"></i>
                                        <span class="caption-subject font-green-sharp bold uppercase">Member Listing</span>
                                    </div>
                                    <div class="pull-right">
                                        <a class="btn btn-circle btn-default" id="printList" href="#">
                                            <i class="fa fa-plus"></i>
                                            <span class="hidden-480">
                                                Add to print list
                                            </span>
                                        </a>
                                    </div>
                                </div>
                                <div class="scroller" style="max-height: 800px; min-height: 799px;"
                                     data-always-visible="0" data-rail-visible="0" data-handle-color="#dae3e7">
                                    <table class="table table-striped table-bordered table-hover" id="member">
                                        <thead>
                                            <tr role="row" class="heading">
                                                <th width="1%">
                                                    No
                                                </th>
                                                <th>
                                                    ID Member
                                                </th>
                                                <th>
                                                    Nama
                                                </th>
                                                <th>
                                                    Actions
                                                </th>
                                            </tr>
                                            <tr role="row" class="filter">
                                                <td></td>
                                                <td>
                                                    <input type="text" class="form-control form-filter input-sm" name="columns[1]FilterSearch">
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control form-filter input-sm" name="columns[2]FilterSearch">
                                                </td>
                                                <td>
                                                    <div class="margin-bottom-5">
                                                        <button class="btn btn-sm yellow filter-submit margin-bottom"><i class="fa fa-search"></i>Search</button>
                                                    </div>
                                                    <button class="btn btn-sm red filter-cancel"><i class="fa fa-times"></i>Reset</button>
                                                </td>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="todo-tasklist-devider">
                            </div>
                            <div class="col-md-7 col-sm-8">
                                @using (Html.BeginForm("PrintCardMember", "Card", FormMethod.Post, new { id = "", @class = "form-horizontal" }))
                                {
                                    <div class="scroller" style="max-height: 800px;" data-always-visible="0" data-rail-visible="0" data-handle-color="#dae3e7">
                                        <!-- TASK HEAD -->
                                        <div class="form">
                                            <div class="form-group">
                                                <div class="col-md-8 col-sm-8">
                                                    <div class="todo-taskbody-user">
                                                        <img width="50" height="50" class="todo-userpic pull-left" src="">
                                                        <span class="todo-username pull-left">Print Member Card</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="height: 800px;">

                                                <table class="table table-striped table-bordered table-hover" id="dtMemberCard" style="width: 600px">
                                                    <thead>
                                                        <tr width="1%">

                                                            <td>
                                                                PersonId
                                                            </td>
                                                            <td>
                                                                No
                                                            </td>

                                                            <td>
                                                                ID
                                                            </td>
                                                            <td>
                                                                Nama
                                                            </td>
                                                            <td>
                                                                Alamat
                                                            </td>
                                                            <td>
                                                                Kota
                                                            </td>
                                                            <td>
                                                                TglLahir
                                                            </td>
                                                            <td>
                                                                Gender
                                                            </td>
                                                            <td></td>
                                                            @*                                                            <td>*@
                                                            @*                                                                <input type="checkbox" id="parent_all" />*@
                                                            @*                                                            </td>*@
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-actions right">
                                        <input type="submit" class="btn btn-circle btn-sm green-haze" value="Print This Card Member">
                                        <button class="btn btn-circle btn-sm btn-default">Cancel</button>
                                    </div>
                                }
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END PAGE CONTENT-->
@section Scripts {

    @Scripts.Render("~/bundle/script/datatable")
    <script>
        $(function () {
            //Metronic.init(); // init metronic core components
            //Layout.init(); // init current layout

            var dtMemberCard = $('#dtMemberCard').DataTable({
                'createdRow': function (row, data, dataIndex) {
                    $(row).attr('id', data[0]);
                },
                "columns": [
                    {
                        visible: false,
                    },
                    {
                        visible: true,
                        orderable: false,
                        width: 3
                    },
                    {
                        visible: true,
                    },
                    {
                        visible: true,
                    },
                    {
                        visible: true,
                    },
                    {
                        visible: false,
                    },
                    {
                        visible: false,
                    },
                    {
                        visible: false,
                    },
                    {
                        visible: true,
                        orderable: false,
                        width: 3
                    },
//                {
//                    visible: true,
//                    orderable: false,
//                    width: 3
//                }
                ]
            });

            var gridMember = new Datatable({
                "serverSide": false,
                "processing": true,
                "filter": true,
                "lengthMenu": [5, 10, 25, 50, 75, 100],
                "pageLength": 10,
                "columns": [
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false

                    },
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false
                    },
                    {
                        "orderable": false
                    }
                ],
                "order": [[1, "asc"]]
            });

            gridMember.init({
                src: $("#member"),
                onSuccess: function (gridMember) {
                    //alert('sucsess');
                },
                onError: function (gridMember) {
                    //alert('fail');
                },
                loadingMessage: 'Loading...',
                dataTable: {
                    // here you can define a typical datatable settings from https://datatables.net/usage/options

                    // Uncomment below line("dom" parameter) to fix the dropdown overflow issue in the datatable cells. The default datatable layout
                    // setup uses scrollable div(table-scrollable) with overflow:auto to enable vertical scroll(see: assets/global/scripts/datatable.js).
                    // So when dropdowns used the scrollable div should be removed.
                    //"dom": "<'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'<'table-group-actions pull-right'>>r>t<'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'>>",
                    "lengthMenu": [
                        [10, 20, 50, 100, 150],
                        [10, 20, 50, 100, 150] // change per page values here
                    ],
                    "pageLength": 10, // default record count per page
                    "ajax": {
                        "url": "@Url.Action("MemberCardResult", "Member", new {area = "Office"})"
                    },
                    "columns": [
                        { "name": "No" },
                        { "name": "MemberID" },
                        { "name": "tPerson.PNama" },
                        {
                            "data": 3,
                            "render": function (data) {
                                var d = data;
                                return '<a href="#" class="addPrintToMember"><i class="fa fa-pencil"></i> Add</a>' +
                                    '<input type="hidden" value=' + d + ' class="dataperson" />';
                            },
                            "orderable": false,
                            "width": "5%"
                        }
                    ],
                    "order": [
                        [1, "asc"]
                    ] // set first column as a default sort by asc
                }
            });

            // handle group actionsubmit button click
            gridMember.getTableWrapper().on('click', '.table-group-action-submit', function (e) {
                e.preventDefault();
                var action = $(".table-group-action-input", gridMember.getTableWrapper());
                if (action.val() != "" && gridMember.getSelectedRowsCount() > 0) {
                    gridMember.setAjaxParam("customActionType", "group_action");
                    gridMember.setAjaxParam("customActionName", action.val());
                    gridMember.setAjaxParam("id", gridMember.getSelectedRows());
                    gridMember.getDataTable().ajax.reload();
                    gridMember.clearAjaxParams();
                } else if (action.val() == "") {
                    Metronic.alert({
                        type: 'danger',
                        icon: 'warning',
                        message: 'Please select an action',
                        container: gridMember.getTableWrapper(),
                        place: 'prepend'
                    });
                } else if (gridMember.getSelectedRowsCount() === 0) {
                    Metronic.alert({
                        type: 'danger',
                        icon: 'warning',
                        message: 'No record selected',
                        container: gridMember.getTableWrapper(),
                        place: 'prepend'
                    });
                }
            });

            $('#printList').on('click', function () {
                var membertype = $('#memberType .active').find('a').text().trim();
                var rowCount = dtMemberCard.rows().data().length;
                $.ajax({
                    url: '@Url.Action("AddtoPrint", "Card")',
                    data: {
                        memberType: membertype,
                        rowCount: rowCount
                    }
                }).done(function (template) {
                    for (var i = 0; i <= template.length - 1; i++) {
                        var personId = $(template[i]).find('.personid').val();
                        if (!dtMemberCard.rows('[id=' + personId + ']').any()) {
                            //                        } else {

                            dtMemberCard.row.add($(template[i])).draw();
                        }

                    }

                });
            });


            $(document).on('click', '.addPrintToMember', function () {
                var personId = $(this).closest('tr').find('.dataperson').val();

                var rowCount = dtMemberCard.rows().data().length;
                $.ajax({
                    url: '@Url.Action("AddDataMember", "Card")',
                    data: {
                        personId: personId,
                        rowCount: rowCount
                    }
                }).done(function (template) {
                    if (dtMemberCard.rows('[id=' + personId + ']').any()) {
                        alert('Data has been added');
                    } else {
                        dtMemberCard.row.add($(template)).draw();
                    }
                    //dtMemberCard.row.add($(template)).draw();
                });
            });

            var dataTableMember = gridMember.getDataTable();

            $('#memberType li').on('click', function () {
                $('#memberType li').removeClass('active');
                $(this).addClass('active');
                //alert($('#memberType .active a').html());
                //alert($(this).html());
                //alert($(this).find('a').text());
                var memberTypeVal = $(this).find('a').text().trim();

                gridMember.resetFilter();
                gridMember.setAjaxParam("MemberType", memberTypeVal);

                dataTableMember.ajax.reload();
            });

            $('#dtMemberCard tbody').on('click', '.delCardMember', function () {
                dtMemberCard.row($(this).parents('tr')).remove().draw();
            });
        });
    </script>
}